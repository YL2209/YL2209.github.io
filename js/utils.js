const btf={debounce:(e,t=0,n=!1)=>{let o;return(...a)=>{const s=n&&!o;clearTimeout(o),o=setTimeout((()=>{o=null,n||e(...a)}),t),s&&e(...a)}},throttle:function(e,t,n={}){let o,a,s,i=0;const c=()=>{i=!1===n.leading?0:(new Date).getTime(),o=null,e.apply(a,s),o||(a=s=null)};return(...l)=>{const r=(new Date).getTime();i||!1!==n.leading||(i=r);const u=t-(r-i);a=this,s=l,u<=0||u>t?(o&&(clearTimeout(o),o=null),i=r,e.apply(a,s),o||(a=s=null)):o||!1===n.trailing||(o=setTimeout(c,u))}},sidebarPaddingR:()=>{const e=window.innerWidth,t=document.body.clientWidth,n=e-t;e!==t&&(document.body.style.paddingRight=n+"px")},snackbarShow:(e,t=!1,n=2e3,o=!1)=>{const{position:a,bgLight:s,bgDark:i}=GLOBAL_CONFIG.Snackbar,c="light"===document.documentElement.getAttribute("data-theme")?s:i;document.querySelector(":root").style.setProperty("--nk-snackbar-snackbar-time",n+"ms"),Snackbar.show({text:e,backgroundColor:c,onActionClick:t,actionText:o,showAction:o,duration:n,pos:a,customClass:"snackbar-css"})},diffDate:(e,t=!1)=>{const n=new Date,o=new Date(e),a=n.getTime()-o.getTime(),s=36e5,i=24*s,{dateSuffix:c}=GLOBAL_CONFIG;if(!t)return parseInt(a/i);const l=a/2592e6,r=a/i,u=a/s,d=a/6e4;return l>12?o.toISOString().slice(0,10):l>=1?`${parseInt(l)} ${c.month}`:r>=1?`${parseInt(r)} ${c.day}`:u>=1?`${parseInt(u)} ${c.hour}`:d>=1?`${parseInt(d)} ${c.min}`:c.just},loadComment:(e,t)=>{if("IntersectionObserver"in window){const n=new IntersectionObserver((e=>{e[0].isIntersecting&&(t(),n.disconnect())}),{threshold:[0]});n.observe(e)}else t()},scrollToDest:(e,t=500)=>{const n=window.pageYOffset,o=document.getElementById("page-header").classList.contains("fixed");if((n>e||o)&&(e-=70),"scrollBehavior"in document.documentElement.style)return void window.scrollTo({top:e,behavior:"smooth"});let a=null;e=+e,window.requestAnimationFrame((function o(s){a=a||s;const i=s-a;n<e?window.scrollTo(0,(e-n)*i/t+n):window.scrollTo(0,n-(n-e)*i/t),i<t?window.requestAnimationFrame(o):window.scrollTo(0,e)}))},animateIn:(e,t)=>{e.style.display="block",e.style.animation=t},animateOut:(e,t)=>{e.addEventListener("animationend",(function t(){e.style.display="",e.style.animation="",e.removeEventListener("animationend",t)})),e.style.animation=t},wrap:(e,t,n)=>{const o=document.createElement(t);for(const[e,t]of Object.entries(n))o.setAttribute(e,t);e.parentNode.insertBefore(o,e),o.appendChild(e)},isHidden:e=>0===e.offsetHeight&&0===e.offsetWidth,getEleTop:e=>{let t=e.offsetTop,n=e.offsetParent;for(;null!==n;)t+=n.offsetTop,n=n.offsetParent;return t},loadLightbox:e=>{const t=GLOBAL_CONFIG.lightbox;if("mediumZoom"===t){const t=mediumZoom(e);t.on("open",(e=>{const n="dark"===document.documentElement.getAttribute("data-theme")?"#121212":"#fff";t.update({background:n})}))}"fancybox"===t&&(Array.from(e).forEach((e=>{if("A"!==e.parentNode.tagName){const t=e.dataset.lazySrc||e.src,n=e.title||e.alt||"";btf.wrap(e,"a",{href:t,"data-fancybox":"gallery","data-caption":n,"data-thumb":t})}})),window.fancyboxRun||(Fancybox.bind("[data-fancybox]",{Hash:!1,Thumbs:{autoStart:!1}}),window.fancyboxRun=!0))},setLoading:{add:e=>{e.insertAdjacentHTML("afterend",'\n        <div class="loading-container">\n          <div class="loading-item">\n            <div></div><div></div><div></div><div></div><div></div>\n          </div>\n        </div>\n      ')},remove:e=>{e.nextElementSibling.remove()}},updateAnchor:e=>{if(e!==window.location.hash){e||(e=location.pathname);const t=GLOBAL_CONFIG_SITE.title;window.history.replaceState({url:location.href,title:t},t,e)}},getScrollPercent:(e,t)=>{const n=t.clientHeight,o=document.documentElement.clientHeight,a=(e-t.offsetTop)/(n>o?n-o:document.documentElement.scrollHeight-o),s=Math.round(100*a);return s>100?100:s<=0?0:s},addGlobalFn:(e,t,n=!1,o=window)=>{const a=o.globalFn||{},s=a[e]||{};n&&s[n]||(s[n=n||Object.keys(s).length]=t,a[e]=s,o.globalFn=a)},addEventListenerPjax:(e,t,n,o=!1)=>{e.addEventListener(t,n,o),btf.addGlobalFn("pjax",(()=>{e.removeEventListener(t,n,o)}))},removeGlobalFnEvent:(e,t=window)=>{const{globalFn:n={}}=t,o=n[e]||{},a=Object.keys(o);a.length&&(a.forEach((e=>{o[e]()})),delete t.globalFn[e])}},naokuo={setValueToBodyType:function(){const e=document.getElementById("page-type").value;document.body.dataset.type=e},removeBodyPaceClass:function(){document.body.className="pace-done"},switchConsole:()=>{const e=document.getElementById("console");document.documentElement.classList.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on"),e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show");const t=document.querySelector("#consoleKeyboard");t&&("true"===localStorage.getItem("keyboardToggle")?(t.classList.add("on"),naokuo_keyboard=!0):(t.classList.remove("on"),naokuo_keyboard=!1))},initConsoleState:function(){document.documentElement.classList.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on")},hideConsole:function(){consoleEl.classList.contains("show")?consoleEl.classList.remove("show"):consoleEl.classList.contains("reward-show")&&consoleEl.classList.remove("reward-show");const e=document.getElementById("center-console");e.checked&&(e.checked=!1)},hideAsideBtn:()=>{const e=document.documentElement.classList;e.contains("hide-aside")?saveToLocal.set("aside-status","show",2):saveToLocal.set("aside-status","hide",2),e.toggle("hide-aside"),e.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on")},cacheAndPlayMusic(){let e=localStorage.getItem("musicData");if(e){e=JSON.parse(e);if((new Date).getTime()-e.timestamp<864e5)return void naokuo.playMusic(e.songs)}fetch("/json/music.json").then((e=>e.json())).then((e=>{const t={timestamp:(new Date).getTime(),songs:e};localStorage.setItem("musicData",JSON.stringify(t)),naokuo.playMusic(e)}))},playMusic(e){const t=document.getElementById("anMusic-page").querySelector("meting-js").aplayer,n=e[Math.floor(Math.random()*e.length)],o=t.list.audios;if(selectRandomSong.includes(n.name)){let a=!1;for(;!a;){const n=e[Math.floor(Math.random()*e.length)];if(selectRandomSong.includes(n.name)||(t.list.add([n]),t.list.switch(o.length),selectRandomSong.push(n.name),a=!0),selectRandomSong.length===e.length)break}if(!a){const e=o.findIndex((e=>e.name===n.name));-1!=e&&t.list.switch(e)}}else t.list.add([n]),t.list.switch(o.length),selectRandomSong.push(n.name);console.info("已随机歌曲：",selectRandomSong,"本次随机歌曲：",n.name)},changeMusicBg:function(e=!0){const t=document.getElementById("an_music_bg");if(e){const e=document.querySelector("#anMusic-page .aplayer-pic");t.style.backgroundImage=e.style.backgroundImage}else{let e=setInterval((()=>{document.querySelector("#anMusic-page .aplayer-pic")&&(clearInterval(e),naokuo.addEventListenerMusic(),naokuo.changeMusicBg(),document.querySelector("#nav-music meting-js").aplayer&&!document.querySelector("#nav-music meting-js").aplayer.audio.paused&&naokuo.musicToggle())}),100)}},getCustomPlayList:function(){if(!window.location.pathname.startsWith("/music/"))return;const e=new URLSearchParams(window.location.search),t=document.getElementById("anMusic-page-meting");if(e.get("id")&&e.get("server")){const n=e.get("id"),o=e.get("server");t.innerHTML=`<meting-js id="${n}" server=${o} type="playlist" type="playlist" mutex="true" preload="auto" theme="var(--nk-music-theme)" order="list" list-max-height="calc(100vh - 169px)!important"></meting-js>`}else t.innerHTML='<meting-js id="3067156818" server="netease" type="playlist" mutex="true" preload="auto" theme="var(--nk-music-theme)" order="list" list-max-height="calc(100vh - 169px)!important"></meting-js>';naokuo.changeMusicBg(!1)},addEventListenerMusic:function(){const e=document.getElementById("anMusic-page"),t=e.querySelector(".aplayer-info .aplayer-time .aplayer-icon-menu"),n=e.querySelector("#anMusicBtnGetSong"),o=e.querySelector("#anMusicRefreshBtn"),a=e.querySelector("#anMusicSwitching"),s=e.querySelector("meting-js").aplayer;s.volume(.8,!0),s.on("loadeddata",(function(){naokuo.changeMusicBg()})),t.addEventListener("click",(function(){document.getElementById("menu-mask").style.display="block",document.getElementById("menu-mask").style.animation="0.5s ease 0s 1 normal none running to_show",e.querySelector(".aplayer.aplayer-withlist .aplayer-list").style.opacity="1"})),document.getElementById("menu-mask").addEventListener("click",(function t(){"/music/"==window.location.pathname?e.querySelector(".aplayer-list").classList.remove("aplayer-list-hide"):document.getElementById("menu-mask").removeEventListener("click",t)})),n.addEventListener("click",(()=>{if(changeMusicListFlag){const e=document.getElementById("anMusic-page").querySelector("meting-js").aplayer,t=e.list.audios,n=Math.floor(Math.random()*t.length);e.list.switch(n)}else naokuo.cacheAndPlayMusic()})),o.addEventListener("click",(()=>{localStorage.removeItem("musicData"),btf.snackbarShow("已移除相关缓存歌曲")})),a.addEventListener("click",(()=>{naokuo.changeMusicList()})),document.addEventListener("keydown",(function(e){"Space"===e.code&&(e.preventDefault(),s.toggle()),39===e.keyCode&&(e.preventDefault(),s.skipForward()),37===e.keyCode&&(e.preventDefault(),s.skipBack()),38===e.keyCode&&musicVolume<=1&&(musicVolume+=.1,s.volume(musicVolume,!0)),40===e.keyCode&&musicVolume>=0&&(musicVolume+=-.1,s.volume(musicVolume,!0))}))},changeMusicList:async function(){const e=document.getElementById("anMusic-page").querySelector("meting-js").aplayer,t=(new Date).getTime(),n=JSON.parse(localStorage.getItem("musicData"))||{timestamp:0};let o=[];if(changeMusicListFlag)o=defaultPlayMusicList;else if(defaultPlayMusicList=e.list.audios,t-n.timestamp<864e5)o=n.songs;else{const e=await fetch("/json/music.json");o=await e.json(),n.timestamp=t,n.songs=o,localStorage.setItem("musicData",JSON.stringify(n))}e.list.clear(),e.list.add(o),changeMusicListFlag=!changeMusicListFlag},addEventListenerConsoleMusicList:function(){const e=document.getElementById("nav-music");e&&e.addEventListener("click",(t=>{const n=e.querySelector(".aplayer-list"),o=e.querySelector("div.aplayer-info > div.aplayer-controller > div.aplayer-time.aplayer-time-narrow > button.aplayer-icon.aplayer-icon-menu svg");t.target!=o&&n.classList.contains("aplayer-list-hide")&&n.classList.remove("aplayer-list-hide")}))},musicBindEvent:function(){document.querySelector("#nav-music .aplayer-music").addEventListener("click",(function(){naokuo.musicTelescopic()})),document.querySelector("#nav-music .aplayer-button").addEventListener("click",(function(){naokuo.musicToggle(!1)}))},musicToggle:function(e=!0){naokuo_musicFirst||(naokuo.musicBindEvent(),naokuo_musicFirst=!0),naokuo_musicPlaying?(navMusicEl.classList.remove("playing"),document.getElementById("nav-music-hoverTips").innerHTML="音乐已暂停",document.querySelector("#consoleMusic").classList.remove("on"),naokuo_musicPlaying=!1,navMusicEl.classList.remove("stretch")):(navMusicEl.classList.add("playing"),document.querySelector("#consoleMusic").classList.add("on"),naokuo_musicPlaying=!0,navMusicEl.classList.add("stretch")),e&&document.querySelector("#nav-music meting-js").aplayer.toggle()},musicTelescopic:function(){navMusicEl.classList.contains("stretch")?navMusicEl.classList.remove("stretch"):navMusicEl.classList.add("stretch")},musicSkipBack:function(){navMusicEl.querySelector("meting-js").aplayer.skipBack()},musicSkipForward:function(){navMusicEl.querySelector("meting-js").aplayer.skipForward()},musicGetName:function(){for(var e=document.querySelector(".aplayer-title"),t=[],n=e.length-1;n>=0;n--)t[n]=e[n].innerText;return t[0]},intersectionObserver:function(e,t){let n;return()=>(n?n.disconnect():n=new IntersectionObserver((n=>{n.forEach((n=>{n.intersectionRatio>0?e?.():t?.()}))})),n)},diffDate:function(e,t=!1,n=!1){const o=new Date,a=new Date(e),s=o.getTime()-a.getTime(),i=6e4,c=36e5,l=24*c,r=30*l;let u;if(t){const e=s/l,t=s/c,n=s/i;u=s/r>=1?a.toLocaleDateString().replace(/\//g,"-"):e>=1?parseInt(e)+" "+GLOBAL_CONFIG.date_suffix.day:t>=1?parseInt(t)+" "+GLOBAL_CONFIG.date_suffix.hour:n>=1?parseInt(n)+" "+GLOBAL_CONFIG.date_suffix.min:GLOBAL_CONFIG.date_suffix.just}else if(n){const e=s/l,t=s/c,n=s/i;u=s/r>=1?a.toLocaleDateString().replace(/\//g,"-"):e>=1&&e<=3?parseInt(e)+" "+GLOBAL_CONFIG.date_suffix.day:e>3?a.getMonth()+1+"/"+a.getDate():t>=1?parseInt(t)+" "+GLOBAL_CONFIG.date_suffix.hour:n>=1?parseInt(n)+" "+GLOBAL_CONFIG.date_suffix.min:GLOBAL_CONFIG.date_suffix.just}else u=parseInt(s/l);return u},changeTimeInAlbumDetail:function(){document.querySelector("#album_detail")&&document.querySelectorAll("#album_detail time").forEach((function(e){var t=e,n=t.getAttribute("datetime");t.innerText=naokuo.diffDate(n,!0),t.style.display="inline"}))},reflashEssayWaterFall:function(){const e=document.getElementById("waterfall");e&&setTimeout((function(){waterfall(e),e.classList.add("show")}),800)},initJustifiedGallery:function(e){const t=e=>{btf.isHidden(e)||fjGallery(e,{itemSelector:".fj-gallery-item",rowHeight:e.getAttribute("data-rowHeight"),gutter:4,onJustify:function(){this.$container.style.opacity="1"}})};0===Array.from(e).length?t(e):e.forEach((e=>{t(e)}))},replaceAll:function(e,t,n){return e.split(t).join(n)},rightMenuCommentText:function(e){var t=document.getElementById("post-comment").offsetTop;window.scrollTo(0,t-80),"undefined"!=e&&"null"!=e||(e="好棒！"),function t(){setTimeout((()=>{var n=document.getElementsByClassName("el-textarea__inner")[0];n||t();let o=document.createEvent("HTMLEvents");o.initEvent("input",!0,!0);let a=naokuo.replaceAll(e,"\n","\n> ");n.value="> "+a+"\n\n",n.dispatchEvent(o),n.focus(),n.setSelectionRange(-1,-1),document.getElementById("comment-tips")&&document.getElementById("comment-tips").classList.add("show")}),100)}()}};